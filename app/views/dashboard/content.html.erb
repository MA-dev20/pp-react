<% content_for :heading do |d| %>
	<div class="search">
		<%= inline_svg_tag 'dash/new_icons/search.svg', class: 'search-icon' %>
		<input type="text" placeholder="Inhalte durchsuchen" id="searchContent">
	</div>
	<div class="heading">
		Inhalte
	</div>
<% end %>
<div class="card" id="content_card">

  <div class="head">
    <h3>Wähle Inhalte</h3>
	</div>

  <div class="scollcontent">

    <div class="standard">

      <% if can? :create, ContentFolder %>
      <div class="card" onclick="redirectContent('my_content')">
        <%= image_tag 'dash/new_icons/myfolder.png'%>
        <div class="title">Mein Inhalt</div>
      </div>
      <% end %>

      <% if @shared_count != 0 %>
      <div class="card" onclick="redirectContent('shared_content')">
        <%= image_tag 'dash/new_icons/sharefolder.png'%>
        <div class="title">Geteilter Inhalt</div>
      </div>
      <% end %>

      <% if @peters_count != 0 %>
      <div class="card" onclick="redirectContent('peters_content')">
        <%= image_tag 'dash/new_icons/PPfolder.png'%>
        <div class="title">Peter's Inhalt</div>
      </div>
      <% end %>
    </div>
    <div class="folders">
    </div>
    <div class="files">

    </div>
    <div class="lists">

    </div>
  </div>

</div>

<script type="text/javascript">
  function redirectContent(type) {
    var URL;
    if( type == 'my_content') {
      URL = "<%= dashboard_my_content_url %>";
    } else if (type == 'shared_content') {
      URL = "<%= dashboard_shared_content_url %>";
    } else if (type == 'peters_content') {
      URL = "<%= dashboard_peters_content_url %>";
    }
    location.replace(URL);
  }
  $('#searchContent').on('keyup', function() {
		var searchVal = $('#searchContent').val();
		var URL = '<%= search_content_path %>';
		$.ajax({
			url: URL,
			type: 'post',
			data: { search: searchVal, level: 'root' },
			beforeSend: function (xhr) { xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content')) },
			success: function (res) {
        if ( res.standard == true ) {
          $('.standard').show();
          $('.folders').hide();
          $('.files').hide();
          $('.lists').hide();
        } else {
          $('.standard').hide();

				var foldersDiv = '<h3>Ordner</h3>';
				if(res.folders.length > 0) {
					$('.folders').show();
					res.folders.forEach(function(item) {
						var userDiv = '<div class="card">';
						userDiv += '<div class="dropdown"><i class="fas fa-ellipsis-v dropdown-icon" aria-hidden="true" onclick="toggleDropdownContent(this)"></i><div class="dropdown-Menu"><div class="point">Edit</div><div class="point">Löschen</div></div></div>'
						userDiv += '<img src="<%= asset_path 'dash/icons/folder.svg' %>" alt="" onclick="redirectFolder('+item["id"]+')">';
						userDiv += '<div class="title" id="title_'+item["id"]+'">'+item["title"]+'<div class="ellipsis">...</div></div>';
						userDiv += '<div class="author">'+item["author"]+'</div>'
						userDiv += '</div>';
						foldersDiv += userDiv;
					})
					$('.folders').html(foldersDiv);
				}	else {
					$('.folders').hide();
				}
				var filesDiv = '<h3>Dateien</h3>';
				if(res.files.length > 0) {
					$('.files').show();
					res.files.forEach(function(item) {
						var userDiv = '<div class="card">';
						userDiv += '<div class="dropdown"><i class="fas fa-ellipsis-v dropdown-icon" aria-hidden="true" onclick="toggleDropdownContent(this)"></i><div class="dropdown-Menu"><div class="point">Edit</div><div class="point">Löschen</div></div></div>';
						userDiv += '<div class="thumb" data-type="'+item["type"]+'" data-id="'+item["id"]+'" onclick="showMedia(this)">';
						if( item["type"] == 'video') {
							userDiv += '<img src="'+item["thumb"]+'" alt="" class="image"><i class="fas fa-play-circle"></i>';
						} else if ( item["type"] == 'image' ){
							userDiv += '<img src="'+item["thumb"]+'" alt="" class="image">';
						} else if ( item["type"] == 'audio' ) {
							userDiv += '<div class="audio-image"><%= image_tag 'dash/audio.png' %></div>';
						}
						userDiv += '</div><div class="text">';
						userDiv += '<div class="title" id="media_title_'+item["id"]+'">'+item["title"]+'<div class="ellipsis">...</div></div>';
						if( item["type"] == 'video') {
							userDiv += '<div class="time"><%= image_tag 'dash/video-icon.png' %>'+item["duration"]+' - '+item["author"]+'</div>';
					  } else if( item["type"] == 'audio') {
							userDiv += '<div class="time"><%= image_tag 'dash/audio.png' %>'+item["author"]+'</div>';
						} else if( item["type"] == 'image') {
							userDiv += '<div class="time"><%= image_tag 'dash/image-icon.png' %>'+item["author"]+'</div>';
						}
						userDiv += '</div>';
						userDiv += '</div>';
						filesDiv += userDiv;
					})
					$('.files').html(filesDiv);
				}	else {
					$('.files').hide();
				}
				var listsDiv = '<h3>Lists</h3>';
				if(res.lists.length > 0) {
					$('.lists').show();
					res.lists.forEach(function(item) {
						var userDiv = '<div class="card">';
						userDiv += '<div class="dropdown"><i class="fas fa-ellipsis-v dropdown-icon" aria-hidden="true" onclick="toggleDropdownContent(this)"></i><div class="dropdown-Menu"><div class="point">Edit</div><div class="point">Löschen</div></div></div>';
						userDiv += '<div class="thumb" data-type="'+item["type"]+'" data-id="'+item["id"]+'" onclick="showMedia(this)">';
						userDiv += '<div class="audio-image"><%= image_tag 'dash/no-image-icon.png' %></div>';
						userDiv += '</div><div class="text">';
						userDiv += '<div class="title" id="media_title_'+item["id"]+'">'+item["name"]+'<div class="ellipsis">...</div></div>';
						userDiv += '<div class="time"><%= image_tag 'dash/no-image-icon.png' %>'+item["user_name"]+'</div>';
						userDiv += '</div>';
						userDiv += '</div>';
						listsDiv += userDiv;
					})
					$('.lists').html(listsDiv);
				} else {
					$('.lists').hide();
				}
			}
        }
		})

	})
</script>
