<div class="background-blur" id="new-list">
  <div class="content-popup">
    <%= image_tag 'icons/close.svg', class: 'close', onclick: 'newList("close")' %>
    <h3>Neue Liste</h3>
    <%= form_for :list, url: create_list_path, html: {id: 'new-list-form'} do |f| %>
      <%= f.hidden_field :content_folder_id, value: params[:folder_id] ? params[:folder_id] : nil %>
      <div class="audio" id="catchword_image">
        <%= image_tag 'dash/noImageIcon.svg' %>
      </div>
      <div class="form-group">
        <%= f.text_field :name, placeholder: 'Name der Liste hier eingeben', class: 'form-field' %>
      </div>
      <div class="btns">
        <div class="btn inverted" onclick="newList()">Abbrechen</div>
        <div class="btn" onclick="submitList()">Erstellen</div>
      </div>
    <% end %>
  </div>
</div>
<script>
  $('#new-list-form').on('submit', function(e) {
    e.preventDefault();
    submitList();
  })
  function submitList() {
    var URL = '<%= create_list_path %>';
    var formData = new FormData(document.getElementById('new-list-form'));
    $.ajax({
      url: URL,
      type: 'post',
      data: formData,
      cache: false,
      contentType: false,
      processData: false,
      beforeSend: function (xhr) { xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content')) },
      success: function(res) {
        if( res.no_title ) {
          $('#list_name').css('border-color', 'red');
        } else {
          <% if params[:folder_id] %>
          location.replace('?folder_id=<%= params[:folder_id] %>&list=' + res.id);
          <% else %>
          location.replace('?list=' + res.id);
          <% end %>
        }
      }
    })
  }
  function newList() {
    $('#new-list').toggle();
  }
</script>
