<div class="form-group title task-fields hide" id="form_1">
    <%= f.hidden_field :user_id, value: @admin.id %>
    <%= f.text_field :title, class: 'title-field form-field title-form-field', onkeyup: "handleKeyEvent(this)", placeholder: 'Tippen, um Aufgabe hinzuzufügen, bspw. "Verkaufe das Catchword an einen Bestandskunden"' %>
    <div class="card time-limit">
        <div class="title">Time limit</div>
        <div class="subline">Set your time limit. Standard time limit is 120 seconds.</div>
        <div class="form-group">
            <div class="time-field">
                <%= f.hidden_field :time, id: 'task_time', value: 80 %>
                <div class="time" id="settime">1:20</div>
                <i class="fa fa-angle-up up" onclick="timeUp(this)"></i>
                <i class="fa fa-angle-down down" onclick="timeDown(this)"></i>
            </div>
        </div>
    </div>
    <div class="card add-catchword">
        <div class="title">Text, Video oder Bild hinzufügen</div>
        <div class="btn-line">
            <div class="btn selected" id="btn_catchword" onclick="chooseCatchword('catchword')">Catchword</div>
            <div class="btn" id="btn_picture" onclick="chooseCatchword('picture')">Bild</div>
            <div class="btn" id="btn_video" onclick="chooseCatchword('video')">Video</div>
            <div class="btn" id="btn_audio" onclick="chooseCatchword('audio')">Audio</div>
        </div>
        <div class="catchword">
            <div class="title">Catchwords</div>
            <div class="subline">Type your catchword or choose from list below</div>
            <div class="form-group">
                <%= f.hidden_field :catchwords, class: 'capsule-field cw-hidden-field' %>
                <%= f.hidden_field :catchword_ids, class: 'capsule-ids-field cw-ids-field' %>
                <input type="text" placeholder="Type your catchword" class="catchword input-field form-field">
                <div id="" class="cw custom-select">Catchword
                    <div class="sub-cs">
                        <% @cw_lists.each do |list| %>
                        <% if list.catchwords.present? %>
                        <div class="option" onmouseover="showList(this)" onmouseout="hideList(this)">
                            <i class="fas fa-caret-left"></i>
                            <span class="basket-name" data-name="<%= list.name %>"
                                data-id="<%= list.id %>"><%= list.name %></span>
                            <div class="list" id="scrollNameList">
                                <% list.catchwords.each do |cw| %>
                                <% if cw.name.present? %>
                                <div class="catchword name" data-name="<%= cw.name %>">
                                    <span><%= cw.name %></span>
                                </div>
                                <% end %>
                                <% end %>
                            </div>
                        </div>
                        <% end %>
                        <% end %>
                    </div>
                </div>
            </div>
            <div class="capsule-list list-with-words">
            </div>
            <!-- <div class="capsule-list <%= f.object.catchwords.present? ? 'list-with-words' : '' %>">
            </div> -->
            <div class="info">If more than one catchword is chosen, we will choose one of them randomly for this
                task.</div>
        </div>
        <div class="picture">
            <div class="title">Bild</div>
            <div class="subline">Upload an image to your pitch</div>
            <div class="btn upload">Upload</div>
            <div class="preview">
                <div class="remove">remove</div>
                <%= image_tag 'dash/Image.png' %>
            </div>
        </div>
        <div class="video">
            <div class="title">Video</div>
            <div class="subline">Upload a video to your pitch</div>
            <div class="btn upload">Upload</div>
            <div class="btn upload open-modal" data-modal="videoModal">Record</div>
            <div class="preview">
                <div class="time">00:16:45</div>
                <div class="remove">remove</div>
                <%= image_tag 'dash/Image.png' %>
            </div>
        </div>
        <div class="audio">
            <div class="title">Audio</div>
            <div class="subline">Upload an audio file to your pitch</div>
            <div class="btn upload">Upload</div>
            <div class="btn upload">Record</div>
            <div class="preview audio-preview">
                <%= image_tag 'dash/icons/audio-icon.svg' %>
                <div class="audio-title">Pitch-audio.mp3</div>
                <div class="remove">remove</div>
            </div>
        </div>
    </div>

    <div class="card add-reaction">
        <div class="title">Reactions</div>
        <div class="subline">Type new reactions or choose from list below</div>
        <div class="form-group">
            <%= f.hidden_field :reactions, class: 'capsule-field reaction-hidden-field' %>
            <%= f.hidden_field :reaction_ids, class: 'capsule-ids-field reaction-ids-field' %>
            <input type="text" placeholder="Type your reaction" class="add-reaction input-field form-field">
            <div id="" class="obj custom-select">Reaction
                <div class="sub-cs">
                    <% @obj_lists.each do |list| %>
                    <% if list.objections.present? %>
                    <div class="option" onmouseover="showList(this)" onmouseout="hideList(this)">
                        <i class="fas fa-caret-left"></i>
                        <span class="basket-name" data-name="<%= list.name %>"
                            data-id="<%= list.id %>"><%= list.name %></span>
                        <div class="list" id="scrollNameList">
                            <% list.objections.each do |obj| %>
                            <% if obj.name.present? %>
                            <div class="add-reaction name" data-name="<%= obj.name %>">
                                <span><%= obj.name %></span>
                            </div>
                            <% end %>
                            <% end %>
                        </div>
                    </div>
                    <% end %>
                    <% end %>
                </div>
            </div>
        </div>
        <div class="capsule-list list-with-words">
        </div>
        <!-- <div class="capsule-list <%= f.object.reactions.present? ? 'list-with-words' : '' %>">
        </div> -->
    </div>

    <div class="card add-rating">
        <div class="title">Rating criterias</div>
        <div class="subline">You can add up to 4 rating criterias</div>
        <div class="form-group">
            <div class="star">
                <%= image_tag 'dash/icons/star.svg'%>
            </div>
            <%= f.hidden_field :ratings, class: 'capsule-field rating-hidden-field' %>
            <input type="text" placeholder="Type new rating criteria" class="form-field rating-field">
            <%= image_tag 'dash/icons/circle-plus-green.svg', class: 'add-rating add add-rating-btn' %>
        </div>
        <div class="capsule-list">
        </div>
    </div>
</div>

<script>


    $(() => {
        $('.input-field').unbind().keypress((e) => {
            if (e.which == 13) {
                let target_field = $(e.target).siblings('.capsule-field')
                let value = $(e.target).val()
                if (value.length) {
                    createCapsule(target_field, value, e)
                    checkTaskData(e)
                }
                $(e.target).val("")
                e.preventDefault();
                return false;
            }
        });

        $('.sub-cs .option').unbind().on('click', (e) => {
            let $that = $(e.target)
            let target_field = $that.closest('.form-group').children('.capsule-ids-field')
            let id = $that.closest('.option').find('.basket-name').attr('data-id')
            let value = $that.closest('.option').find('.basket-name').attr('data-name')
            let capsule_list = $that.closest('.form-group').siblings('.capsule-list')
            // $(capsule_list).addClass('list-with-words');
            let word = $(`<div class="word">${value}</div>`);
            if ($(target_field).val() != "") {
                let field_array = JSON.parse($(target_field).val())
                if (!field_array.includes(id)) {
                    field_array.push(id)
                    $(target_field).val(JSON.stringify(field_array))
                    $(capsule_list).append(word)
                }
            } else {
                $(target_field).val(JSON.stringify(Array(id)))
                $(capsule_list).append(word)
            }
            checkTaskData(e);
            hideDropdown();
            e.preventDefault();
            return false;
        })

        $('.sub-cs .list .name').unbind().click(function (e) {
            let target_field = $(this).closest('.form-group').children('.capsule-field')
            createCapsule(target_field, $(this).attr('data-name'), e);
            checkTaskData(e);
            hideDropdown();
            return false;
        })

        $('.add-rating-btn').on('click', (e) => {
            addRatingValue(e)
        })

        $('.rating-field').unbind().on('keypress', (e) => {
            if (e.keyCode == 13) {
                addRatingValue(e, $(e.currentTarget))
            }
        })
    })
</script>